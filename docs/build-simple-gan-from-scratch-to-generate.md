# å‘ç°ä¸ºä»€ä¹ˆç”˜æ˜¯å¯æ€•çš„ï¼

> åŸæ–‡ï¼š<https://blog.paperspace.com/build-simple-gan-from-scratch-to-generate/>

![](img/a0f4625f8247e1db1ae24a11d22ca020.png)

[Image source](https://okanky.medium.com/generative-adversarial-networks-2886ba393ba2)

# ä¸ºä»€ä¹ˆç”˜å¾ˆç‰›é€¼ï¼Ÿ

å½“æˆ‘ä»¬è°ˆè®ºç°ä»£æ·±åº¦å­¦ä¹ æ—¶ï¼Œé¦–å…ˆæƒ³åˆ°çš„ã€æœ€å—æ¬¢è¿çš„ã€é€šå¸¸ä¹Ÿæ˜¯æœ€æœ‰ç”¨çš„æ¦‚å¿µæ˜¯**ç”Ÿæˆå¯¹æŠ—ç½‘ç»œ** ( **ç”˜æ–¯**)ã€‚è¿™äº›éƒ½æœ‰å¾ˆå¤šå¾ˆæ£’çš„åº”ç”¨ï¼Œæ¯”å¦‚:

*   **ç”Ÿæˆä¸å­˜åœ¨çš„çœŸå®äººè„¸**

è¿™äº›è„¸éƒ½æ˜¯å‡çš„ï¼Œ[éƒ½æ˜¯ç”˜](https://blog.paperspace.com/stylegan3-gradient-notebooks/)åšçš„ï¼Œæ‰€ä»¥å¾ˆé—æ†¾ä½ è§ä¸åˆ°ä»–ä»¬ğŸ˜”ã€‚

![](img/fbfd791a4d28280098915d8b569393cd.png)

Random Sample of human faces that do not exist captured from [human faces that do not exist](https://this-person-does-not-exist.com/fr)

*   **ä¿®å¤ã€ç§»æ¤å’Œæé«˜ç…§ç‰‡çš„åˆ†è¾¨ç‡**

å¦‚æœä½ æœ‰ä¸€ä¸ªè¿‡æ—¶çš„æŸåå›¾åƒï¼ŒGANs å¯ä»¥å¸®åŠ©ä½ æ¢å¤å®ƒï¼Œæ·»åŠ ä¸€äº›é¢œè‰²ï¼Œæé«˜å®ƒçš„åˆ†è¾¨ç‡ğŸ˜Šã€‚

è·Ÿéš GFPGAN ä¸Šçš„è¿™ä¸ªæ•™ç¨‹ï¼Œå­¦ä¹ å¦‚ä½•å‡çº§å’Œæ¢å¤æŸåçš„ç…§ç‰‡ã€‚

![](img/7839e33c1afced92a25899428e335fa2.png)

[Image source](https://www.linkedin.com/in/tauil-abd-elilah-076967176/recent-activity/#)

*   **è·¨åŸŸè½¬æ¢å›¾åƒï¼Œé£æ ¼è½¬ç§»**

![](img/deda13039df14d98ee88ea6b0b16ccfb.png)

[Image source](https://arxiv.org/pdf/1611.07004.pdf)

å¦ä¸€ä¸ªå¾ˆé…·çš„åº”ç”¨æ˜¯è·¨åŸŸè½¬æ¢å›¾åƒã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨æ ·å¼è½¬ç§»ï¼Œæˆ‘ä»¬å¯ä»¥æ‹æ‘„ä¸€å¹…é©¬çš„å›¾åƒå¹¶å°†å…¶è½¬æ¢ä¸ºæ–‘é©¬ï¼Œæ‹æ‘„ä¸€å¹…å¤å¤©çš„å›¾åƒå¹¶å°†å…¶è½¬æ¢ä¸ºå†¬å¤©ï¼Œæˆ–è€…æ‹æ‘„ä¸€å¹…è¯­ä¹‰å›¾å¹¶è¾“å‡ºè¯¥è¯­ä¹‰å›¾çš„çœŸå®å›¾åƒã€‚

[çœ‹çœ‹è¿™ç¯‡æ•™ç¨‹ï¼Œå­¦ä¹ å¦‚ä½•ç”¨](https://blog.paperspace.com/one-shot-face-stylization-with-jojogan/) [JojoGAN](https://blog.paperspace.com/one-shot-face-stylization-with-jojogan/) å¯¹äººè„¸è¿›è¡Œè¿™æ ·çš„å˜æ¢ã€‚

![](img/2cd9d8f23949b271ea5e40c2573efe54.png)

[Image source](https://arxiv.org/pdf/1703.10593.pdf)

*   **æ•°æ®æ‰©å……**

gan è¿˜ç»å¸¸ç”¨äº[æ•°æ®å¢å¼º](https://blog.paperspace.com/tag/series-data-augmentation/)ï¼Œè¿™æ˜¯ä¸€ä¸ªéå¸¸æ˜ç¡®çš„åº”ç”¨ï¼Œä½†å¯èƒ½ä¸å¤ªæ¸…æ¥šçš„æ˜¯è¿™äº›æ¨¡å‹åœ¨åŒ»ç–—åº”ç”¨ä¸­çš„æ•ˆç”¨ã€‚ç”±äºæ¥è‡ª GANs çš„æ•°æ®ä¸æ˜¯æ¥è‡ªä¸€ä¸ªçœŸå®çš„äººï¼Œè¿™æ„å‘³ç€å®ƒå¯ä»¥åœ¨æ²¡æœ‰é“å¾·å’Œéšç§é—®é¢˜å’Œé™åˆ¶çš„æƒ…å†µä¸‹ä½¿ç”¨ï¼Œè¿™æ˜¯ä¸€ä¸ªéå¸¸é…·çš„åº”ç”¨ç¨‹åºã€‚

**æ¦‚è¦:**

åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬çœ‹åˆ°çš„åªæ˜¯ä¸€å°éƒ¨åˆ†ä¾‹å­ï¼Œè¿˜æœ‰å¾ˆå¤šå¾ˆå¤šã€‚æ¯å¤©éƒ½æœ‰æ–°çš„åº”ç”¨è¢«å‘ç°ï¼Œå› ä¸ºè¿™æ˜¯ä¸€ä¸ªéå¸¸çƒ­é—¨çš„ç ”ç©¶é¢†åŸŸã€‚ç°åœ¨è®©æˆ‘ä»¬ç»§ç»­çœ‹çœ‹ä»€ä¹ˆæ˜¯çœŸæ­£çš„ç”˜ï¼Œçœ‹çœ‹ä»–ä»¬èƒŒåçš„æƒ³æ³•ã€‚

* * *

# ä»€ä¹ˆæ˜¯ GANsï¼Œå®ƒä»¬æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ

GANs æ˜¯ä¸€ç§æœºå™¨å­¦ä¹ æŠ€æœ¯ï¼Œç”±**å’Œ**ä¸¤ä¸ªç½‘ç»œè¿›è¡Œ**å¯¹æŠ—æ¸¸æˆ**ç»„æˆã€‚å…¶ä¸­ä¸€ä¸ªç½‘ç»œç§°ä¸º**ç”Ÿæˆå™¨**ã€**ã€**åˆ›å»ºæ ·æœ¬ï¼Œå¦ä¸€ä¸ªç½‘ç»œç§°ä¸º**é‰´åˆ«å™¨**ï¼Œè¯•å›¾è¾¨åˆ«å›¾åƒä¸çœŸå®ç‰ˆæœ¬ç›¸æ¯”æœ‰å¤šçœŸå®ã€‚

å‡è®¾ç”Ÿæˆå™¨æƒ³è¦æ‰“å°ä¸€ç»„å‡çš„æ‰‹å†™æ•°å­—ï¼Œä¸€ä¸ªé‰´åˆ«å™¨æƒ³è¦åŒºåˆ†çœŸå‡ã€‚åœ¨ GANs çš„è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œå‡è®¾ç”Ÿæˆå™¨è¯•å›¾æ‰“å°åŒ…å«æ•°å­— 8 çš„æ‰‹å†™æ•°å­—ã€‚æœ€åˆï¼Œç”±äºç¼ºä¹è®­ç»ƒï¼Œæ¯ä¸ªç”Ÿæˆçš„æ ·æœ¬çœ‹èµ·æ¥åƒéšæœºå™ªå£°ï¼Œå› æ­¤é‰´åˆ«å™¨å°†å°è¯•æ¯”è¾ƒç”Ÿæˆçš„éšæœºæ ·æœ¬å’Œæ•°å­— 8 çš„çœŸå®å›¾åƒçš„ç›¸ä¼¼æ€§ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒä¼šè¯´æ¥è‡ªå‘ç”Ÿå™¨çš„ä¿¡å·æ˜¯å‡çš„ï¼Œæ‰€ä»¥å‘ç”Ÿå™¨ä¸èƒ½åœ¨ä¸€å¼€å§‹æ¬ºéª—é‰´åˆ«å™¨ã€‚

![](img/c5fbd7190803069275c71378c23d97d6.png)

The fake eight is taken from the simple GAN that we will build (epoch 0)

ä½†æ˜¯éšç€è®­ç»ƒçš„è¿›è¡Œï¼Œç”Ÿæˆå™¨è¿è¡Œçš„æ—¶é—´è¶Šæ¥è¶Šé•¿ï¼Œå®ƒç°åœ¨å¯èƒ½ä¼šäº§ç”Ÿä¸€äº›çœ‹èµ·æ¥æ¥è¿‘çœŸå®æ‰‹å†™ 8 çš„ä¸œè¥¿ã€‚è¿™æ˜¯å› ä¸ºåœ¨æ¯ä¸€æ­¥ï¼ŒçœŸå®å’Œè™šå‡å›¾åƒä¹‹é—´çš„æŸå¤±è¢«åå‘ä¼ æ’­åˆ°ä¸‹ä¸€æ¬¡è¿­ä»£çš„å¼€å§‹ã€‚æ¢¯åº¦ä¸‹é™çš„æ¯ä¸€æ­¥åˆ†åˆ«é™ä½çœŸå®å›¾åƒå’Œç”Ÿæˆå›¾åƒçš„çœŸå®åˆ†å¸ƒå’Œç”Ÿæˆåˆ†å¸ƒä¹‹é—´çš„è·ç¦»ã€‚

ä½¿ç”¨äººç±»çš„æ´å¯ŸåŠ›åœ¨ä¸Šé¢çš„ä¾‹å­å›¾åƒä¸Šï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸€äº›ä¸æ­£ç¡®çš„åƒç´ ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ¨æ–­é‰´åˆ«å™¨å¯èƒ½ä¼šçœ‹ç€è¿™ä¸¤ä¸ªï¼Œå†æ¬¡è¯´æ¥è‡ªç”Ÿæˆå™¨çš„é‚£ä¸ªæ˜¯å‡çš„ã€‚å°½ç®¡å¦‚æ­¤ï¼Œè¿˜æ˜¯å–å¾—äº†è¿›å±•ã€‚

![](img/717533762a7d8ad5572dab494e8427dd.png)

The fake eight is taken from the simple GAN that we will build (epoch 50)

éšç€è®­ç»ƒçš„æ·±å…¥ï¼Œç”Ÿæˆå™¨å°†å¼€å§‹ç”Ÿæˆçœ‹èµ·æ¥æ›´çœŸå®çš„è¾“å‡ºã€‚å½“é‰´åˆ«å™¨ä¸èƒ½åŒºåˆ†çœŸå‡æ ·æœ¬æ—¶ï¼Œå®ƒæœ€ç»ˆä¼šè¯•å›¾æ–­è¨€çœŸæ­£çš„æ‰‹å†™æ•°å­—å°±æ˜¯å‡çš„ã€‚æœ€åï¼Œç”Ÿæˆå™¨èƒ½å¤Ÿéª—è¿‡é‰´åˆ«å™¨ã€‚

![](img/000bd1b2965cff3a3ba857d8f30ba77f.png)

The fake eight is taken from the simple GAN that we will build (epoch 90)

æœ€ç»ˆï¼Œ**ç”Ÿæˆå™¨**ç”Ÿæˆå‡ ä¹æ— æ³•ä¸çœŸå®æ•°å­—**åŒºåˆ†çš„æ‰‹å†™æ•°å­—**ï¼Œè€Œ**é‰´åˆ«å™¨**è¢«è¿«çŒœæµ‹(å¤§è‡´æˆåŠŸæ¦‚ç‡ä¸º 1/2)ã€‚

> **æ³¨:**ä¸¤ä¸ª**é‰´åˆ«å™¨**å’Œ**å‘ç”Ÿå™¨**å®é™…ä¸Šéƒ½æ˜¯ä» **scratch** å¼€å§‹ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒä»¬éƒ½æ˜¯åœ¨å¼€å§‹æ—¶éšæœºåˆå§‹åŒ–ï¼Œç„¶å**åŒæ—¶è®­ç»ƒ**ã€‚

* * *

# æŸå¤±å‡½æ•°æ˜¯ä»€ä¹ˆï¼Ÿ

æˆ‘æƒ³ç°åœ¨å·²ç»å¾ˆæ¸…æ¥šäº†ï¼Œåœ¨ GANs ä¸­ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªç”¨äºå‘ç”Ÿå™¨çš„ç½‘ç»œï¼Œè¿˜æœ‰ä¸€ä¸ªç”¨äºé‰´é¢‘å™¨çš„ç½‘ç»œï¼Œæˆ‘ä»¬ç¨åä¼šçœ‹åˆ°å¦‚ä½•å®ç°å®ƒã€‚

ç°åœ¨éœ€è¦ç†è§£çš„æœ€é‡è¦çš„éƒ¨åˆ†ä¹‹ä¸€æ˜¯æŸå¤±å‡½æ•°æ˜¯ä»€ä¹ˆæ ·å­çš„ï¼Œä»¥åŠå®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚

### é‰´é¢‘å™¨æŸè€—

å½“*é‰´åˆ«å™¨*è¢«è®­ç»ƒæ—¶ï¼Œå®ƒå¯¹æ¥è‡ªå‘ç”Ÿå™¨çš„çœŸå®æ•°æ®å’Œè™šå‡æ•°æ®è¿›è¡Œåˆ†ç±»ã€‚

é€šè¿‡æœ€å¤§åŒ–ä¸‹é¢çš„å‡½æ•°ï¼Œå®ƒæƒ©ç½šè‡ªå·±å°†ä¸€ä¸ªçœŸå®çš„å®ä¾‹è¯¯åˆ†ç±»ä¸ºå‡çš„ï¼Œæˆ–è€…å°†ä¸€ä¸ªå‡çš„å®ä¾‹(ç”±ç”Ÿæˆå™¨åˆ›å»º)è¯¯åˆ†ç±»ä¸ºçœŸå®çš„ã€‚

![](img/7038c2cdb2c070f895eac21f45f2b420.png)

Discriminator loss

**å…¶ä¸­:**

**m:** è®­ç»ƒæ ·æœ¬æ•°ã€‚

**D:** é‰´åˆ«å™¨ã€‚

**x(i):** è®­ç»ƒä¾‹ Iï¼Œè¿™ä¹ˆä¸€ä¸ªçœŸå®çš„æ‰‹å†™å›¾åƒã€‚

**G:** å‘ç”µæœºã€‚

**z(i):** å°†è¦è¾“å…¥åˆ°å‘ç”µæœºçš„éšæœºå™ªå£°ã€‚

ç°åœ¨è®©æˆ‘ä»¬æ¥çœ‹ä¸€ç‚¹ç»†èŠ‚

*   å¯¹äºç¬¬ä¸€é¡¹ **log(D(x(i)))ï¼Œ** (x(i)æ˜¯çœŸå®çš„å›¾åƒ)æ‰€ä»¥å¦‚æœé‰´åˆ«å™¨èƒ½å¤ŸåŒºåˆ†çœŸä¼ªï¼Œå®ƒå°†è¾“å‡º 1ï¼Œå¹¶ä¸” log(1)=0
*   åœ¨å¦ä¸€é¡¹ **log(1 - D(z(i)))** ä¸­ï¼Œç”Ÿæˆå™¨è¦å–ä¸€äº›éšæœºå™ªå£° z(i)ï¼Œå®ƒè¦è¾“å‡ºçœ‹èµ·æ¥æ¥è¿‘çœŸå®å›¾åƒçš„ä¸œè¥¿ï¼Œé‰´åˆ«å™¨å¦‚æœæ²¡æœ‰è¢«ç”Ÿæˆå™¨å¿½æ‚ å°±è¾“å‡º 0ï¼Œlog(1-0)=0ã€‚
*   åœ¨å…¬å¼çš„å¼€å§‹ï¼Œæˆ‘ä»¬åªæœ‰æ‰€æœ‰è®­ç»ƒæ ·æœ¬ m çš„å¹³å‡å€¼ã€‚

### å‘ç”µæœºæŸè€—

å½“ç”Ÿæˆå™¨è¢«è®­ç»ƒæ—¶:å®ƒå¯¹éšæœºå™ªå£°è¿›è¡Œé‡‡æ ·ï¼Œå¹¶ä»è¯¥å™ªå£°ä¸­äº§ç”Ÿä¸€ä¸ªè¾“å‡ºã€‚ç„¶åï¼Œè¾“å‡ºé€šè¿‡é‰´åˆ«å™¨ï¼Œå¹¶æ ¹æ®é‰´åˆ«å™¨è¾¨åˆ«çœŸä¼ªçš„èƒ½åŠ›è¢«åˆ†ç±»ä¸ºçœŸæˆ–å‡ã€‚

ç„¶åï¼Œæ ¹æ®é‰´åˆ«å™¨çš„åˆ†ç±»è®¡ç®—å‘ç”µæœºæŸè€—â€”â€”å¦‚æœæˆåŠŸéª—è¿‡é‰´åˆ«å™¨ï¼Œå°†è·å¾—å¥–åŠ±ï¼Œå¦åˆ™å°†å—åˆ°æƒ©ç½šã€‚

ä¸‹é¢çš„ç­‰å¼è¢«æœ€å°åŒ–ä»¥è®­ç»ƒå‘ç”Ÿå™¨:

![](img/d54fbe21b48af0af8193cbf41f81fba2.png)

Generator loss

### åˆè®¡æŸå¤±

å¦‚æœæˆ‘ä»¬ä¸€èµ·æŸå¤±ï¼Œæˆ‘ä»¬ä¼šæœ‰è¿™ä¸ªè¡¨è¾¾å¼:

![](img/b7b6540769332e0b666678ef8ea2f9ec.png)

[Source image](https://arxiv.org/pdf/1406.2661.pdf)

æˆ‘ä»¬å¸Œæœ›æœ€å°åŒ–å…³äºå‘ç”Ÿå™¨ï¼Œæˆ‘ä»¬å¸Œæœ›æœ€å¤§åŒ–å…³äºé‰´åˆ«å™¨ï¼Œè¿™å¯¼è‡´äº†è¿™ä¸ªæå°æå¤§åšå¼ˆã€‚æˆ‘ä»¬å¸Œæœ›å¯¹æŸä¸ªå€¼å‡½æ•° **V** æ‰§è¡Œæ­¤æ“ä½œï¼Œè¯¥å‡½æ•°å°†é‰´åˆ«å™¨ **D** å’Œå‘ç”Ÿå™¨ **G** ä½œä¸ºè¾“å…¥ï¼Œæˆ‘ä»¬å¸Œæœ›è®¡ç®— x çš„æœŸæœ›å€¼ï¼Œå…¶ä¸­ x æ¥è‡ªæŸä¸ªå®é™…æ•°æ®åˆ†å¸ƒ **Ex~p(data(x))** ã€‚æˆ‘ä»¬å¸Œæœ›å¯¹ **log(D(x))** ä¹Ÿè¿™æ ·åšã€‚ç„¶åï¼Œæˆ‘ä»¬è¦æ·»åŠ  z çš„æœŸæœ›å€¼ï¼Œå…¶ä¸­ z æ¥è‡ªæŸä¸ªéšæœºåˆ†å¸ƒ **Ex~p(z(z))** ï¼Œæˆ‘ä»¬è¦å¯¹ **log(1-D(G(z)))** è¿™æ ·åšã€‚

### æ³¨æ„:

ä»å‘ç”Ÿå™¨çš„è§’åº¦æ¥çœ‹ï¼ŒæŸå¤±å‡½æ•°å…·æœ‰éå¸¸å¼±çš„æ¢¯åº¦ï¼Œå› æ­¤åœ¨å®è·µä¸­ï¼Œå‘ç”Ÿå™¨è¢«è®­ç»ƒä¸ºæœ€å¤§åŒ–è¯¥è¡¨è¾¾å¼ä½œä¸ºæŸå¤±å‡½æ•°:

![](img/1574456193128e9b5c50d94d0066ab1e.png)

å‘ç”Ÿå™¨çš„è¿™ä¸ªæ–°çš„æŸå¤±å‡½æ•°å¯¼è‡´éé¥±å’Œæ¢¯åº¦ï¼Œè¿™ä½¿å¾—è®­ç»ƒå®¹æ˜“å¾—å¤š

* * *

# ä»é›¶å¼€å§‹æ„å»ºæˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªç®€å• GAN ä»¥ç”Ÿæˆ MNIST

ä¸ºäº†å­¦ä¹ æ–°æ¦‚å¿µæˆ–æ–°è½¯ä»¶ï¼Œæœ€å¥½é¦–å…ˆä½¿ç”¨æ²¡æœ‰é—®é¢˜çš„æ ·æœ¬æ•°æ®é›†ï¼Œå¯¹æˆ‘æ¥è¯´ï¼ŒMNIST æ•°æ®é›†æ˜¯ä¸€ä¸ªå®Œç¾çš„é€‰æ‹©ï¼Œå› ä¸ºåœ¨æˆ‘ä»¬çœ‹æ¥ï¼Œå®ƒæ˜¯æœ€å®¹æ˜“ä½¿ç”¨çš„å›¾åƒæ•°æ®ã€‚è¿™å°±åƒè®¡ç®—æœºè§†è§‰ä¸­çš„â€œhello world â€,ä»–ä»¬è¯´å¦‚æœæŸæ ·ä¸œè¥¿åœ¨ MNIST æ•°æ®é›†ä¸­ä¸èµ·ä½œç”¨ï¼Œå®ƒå¯èƒ½æ°¸è¿œä¹Ÿä¸ä¼šèµ·ä½œç”¨ã€‚åœ¨æ¥ä¸‹æ¥çš„æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨æ›´é«˜çº§çš„ GANs å¤„ç†æ›´å¤æ‚çš„æ•°æ®ã€‚

å› æ­¤ï¼Œåœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†é‡ç‚¹ä»é›¶å¼€å§‹æ„å»ºä¸€ä¸ªç®€å•çš„ GAN æ¥ç”Ÿæˆä» 0 åˆ° 9 çš„æ‰‹å†™æ•°å­—ã€‚

ç°åœ¨è®©æˆ‘ä»¬å¼€å§‹åº“å¯¼å…¥ã€‚

### åŠ è½½æˆ‘ä»¬éœ€è¦çš„æ‰€æœ‰ä¾èµ–é¡¹

ç¬¬ä¸€æ­¥ï¼Œæˆ‘ä»¬å°†å¯¼å…¥ä»å¤´æ„å»ºä¸€ä¸ªç®€å•çš„ GAN æ‰€éœ€çš„æ‰€æœ‰ä¾èµ–é¡¹ã€‚

æˆ‘ä»¬é¦–å…ˆå°†ä¸ºçº¿æ€§ä»£æ•°å¯¼å…¥ Numpyã€‚ç„¶åï¼Œæˆ‘ä»¬æƒ³ä½¿ç”¨ PyTorchï¼Œæ‰€ä»¥è®©æˆ‘ä»¬å¯¼å…¥ Torchï¼Œå¹¶ä» torch å¯¼å…¥ nnã€‚è¿™å°†æœ‰åŠ©äºæˆ‘ä»¬åˆ›å»ºå’Œè®­ç»ƒç½‘ç»œ(é‰´åˆ«å™¨å’Œç”Ÿæˆå™¨)ï¼ŒåŒæ—¶è®©æˆ‘ä»¬å¯¼å…¥ optimï¼Œè¿™æ˜¯ä¸€ä¸ªå®ç°*å„ç§ä¼˜åŒ–ç®—æ³•çš„åŒ…(ä¾‹å¦‚ sgdã€adamã€..).*ä» torch.utils.data å¯¼å…¥æ•°æ®åŠ è½½å™¨*æ¥åˆ›å»ºå°æ‰¹é‡ã€‚*

> **æ³¨**:å¾ˆå¤šæƒŠäººçš„æ•°æ®ç§‘å­¦å®¶åˆ†åˆ«æ˜¯è¿™æ ·å¯¼å…¥ nn å’Œ optim çš„:å¯¼å…¥ torch.nn ä¸º nnï¼Œå¯¼å…¥ torch.optim ä¸º optimã€‚

æˆ‘ä»¬è¿˜å°†å¯¼å…¥ç«ç‚¬è§†è§‰ï¼Œå› ä¸ºæˆ‘ä»¬æ˜¾ç„¶æ˜¯åœ¨å¤„ç†å›¾åƒã€‚ä» torchvisionï¼Œæˆ‘ä»¬å°†å¯¼å…¥è½¬æ¢å’Œæ•°æ®é›†æ¥ä¸‹è½½æˆ‘ä»¬çš„æ•°æ®å¹¶åº”ç”¨ä¸€äº›è½¬æ¢ã€‚æœ€åï¼Œæˆ‘ä»¬å°†å¯¼å…¥ matplotlib.pyplot ä½œä¸º plt æ¥ç»˜åˆ¶ç»“æœå’Œä¸€äº›çœŸå®æ ·æœ¬ã€‚

```py
import numpy as np 
import torch
from torch import nn, optim
from torch.utils.data import DataLoader
import torchvision
import torchvision.transforms as transforms
import torchvision.datasets as datasets
import matplotlib.pyplot as plt
```

### é‰´åˆ«å™¨

ç°åœ¨è®©æˆ‘ä»¬æ¥æ„å»ºé‰´åˆ«å™¨ï¼Œä»æˆ‘ä¹‹å‰å±•ç¤ºçš„ç¤ºä¾‹æ¥çœ‹ï¼Œå®ƒå°†å……å½“æˆ‘ä»¬çš„åˆ¤æ–­å™¨ï¼Œå› æ­¤é‰´åˆ«å™¨å°†åˆ¤æ–­å›¾åƒï¼Œå¹¶åˆ¤æ–­å®ƒæ˜¯çœŸå›¾åƒè¿˜æ˜¯å‡å›¾åƒã€‚

é‰´åˆ«å™¨ç±»å°†ä» **nn ç»§æ‰¿ã€‚æ¨¡å—**ï¼Œè¿™å°†æ˜¯ä¸€ä¸ªéå¸¸ç®€å•çš„æ¨¡å‹ï¼Œå®ƒå°†æ¥è‡ª MNIST æ•°æ®é›†çš„è¾“å…¥ **in_features** ï¼Œå› æ­¤å®ƒå°†ç­‰äº 28*28*1= 784ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä»¥ä¸‹å±‚æ¥æ„å»ºæˆ‘ä»¬çš„æ¨¡å‹:

*   **nnã€‚çº¿æ€§**:è¿™åŸºæœ¬ä¸Šæ˜¯ä¸€ä¸ªå®Œå…¨è¿æ¥çš„å±‚
*   **nnã€‚LeakyReLU** :è¿™æ˜¯åº”ç”¨äºç½‘ç»œä¸­å„ç§è¾“å‡ºçš„æ¿€æ´»ï¼Œå¯ä»¥ä½¿ç”¨ **nnã€‚ReLU** ï¼Œä½†æ˜¯åœ¨ GANs LeakyReLU å¾€å¾€æ˜¯æ›´å¥½çš„é€‰æ‹©ï¼Œæˆ–è€…è‡³å°‘æ˜¯æ›´å¥½çš„é»˜è®¤ã€‚
*   **nnã€‚Sigmoid():** åœ¨æœ€åä¸€å±‚ä½¿ç”¨å®ƒï¼Œç¡®ä¿ç»“æœåœ¨ 0 å’Œ 1 ä¹‹é—´

```py
class Discriminator(nn.Module):
    def __init__(self, in_features):
        super().__init__()
        self.disc = nn.Sequential(
            nn.Linear(in_features, 256),
            nn.LeakyReLU(0.1),
            nn.Linear(256, 128),
            nn.LeakyReLU(0.1),
            nn.Linear(128, 1),
            nn.Sigmoid()
        )
    def forward(self, x):
        return self.disc(x)
```

### å‘ç”µæœº

è®©æˆ‘ä»¬ç°åœ¨æ„å»ºç”Ÿæˆå™¨ï¼Œå®ƒå°†ç”Ÿæˆçœ‹èµ·æ¥åƒçœŸçš„æ‰‹å†™æ•°å­—çš„å‡æ•°å­—ï¼Œå¹¶è¯•å›¾æ¬ºéª—é‰´åˆ«å™¨ã€‚

ç”Ÿæˆå™¨ç±»ä¹Ÿå°†ä» **nn ç»§æ‰¿ã€‚æ¨¡å—**ï¼Œè¿™å°†æ˜¯ä¸€ä¸ªéå¸¸ç®€å•çš„æ¨¡å‹ï¼Œå°†å™ªå£° **z_dim** ä½œä¸ºè¾“å…¥ï¼Œå¹¶ä»ä¸­ç”Ÿæˆå‡å›¾åƒã€‚æˆ‘ä»¬å°†ä½¿ç”¨ç›¸åŒçš„å±‚æ¥å»ºç«‹è¿™ä¸ªæ¨¡å‹ï¼Œé™¤äº†åœ¨æœ€åçš„æ¿€æ´»å‡½æ•°ä¸­æˆ‘ä»¬å°†ä½¿ç”¨**ç¥ç»ç½‘ç»œã€‚Tanh** ç¡®ä¿è¾“å‡ºçš„åƒç´ å€¼åœ¨-1 å’Œ 1 ä¹‹é—´ã€‚æˆ‘ä»¬è¿™æ ·åšæ˜¯å› ä¸ºæˆ‘ä»¬è¦å¯¹æ¥è‡ª MNIST æ•°æ®é›†çš„è¾“å…¥è¿›è¡Œå½’ä¸€åŒ–ï¼Œä»¥ç¡®ä¿å®ƒåœ¨-1 å’Œ 1 ä¹‹é—´ã€‚

```py
class Generator(nn.Module):
    def __init__(self, z_dim, img_dim):
        super().__init__()
        self.gen = nn.Sequential(
            nn.Linear(z_dim, 256),
            nn.LeakyReLU(0.1),
            nn.Linear(256, 512),
            nn.LeakyReLU(0.1),
            nn.Linear(512, img_dim),
            nn.Tanh()
        )
    def forward(self, x):
        return self.gen(x)
```

### è¶…å‚æ•°

GAN å¯¹è¶…å‚æ•°éå¸¸æ•æ„Ÿï¼Œå°¤å…¶æ˜¯åœ¨è¿™ä¸ªç®€å•çš„ GAN ä¸­ã€‚æˆ‘ä»¬åœ¨æŸç§ç¨‹åº¦ä¸Šå¤åˆ¶äº†æœ€åˆçš„ GAN è®ºæ–‡ã€‚åœ¨æ–°çš„è®ºæ–‡ä¸­ï¼Œä»–ä»¬æå‡ºäº†æ›´å¥½çš„æ–¹æ³•æ¥ç¨³å®š GANsï¼Œä½†æˆ‘ä»¬å°†æŠŠå®ƒç•™åˆ°ä»¥åçš„æ–‡ç« ä¸­ã€‚

```py
DEVICE  = 'cuda' if torch.cuda.is_available() else 'cpu'
LR      = 3e-4
Z_DIM   = 64
IMG_DIM = 28*28*1
BS      = 64
EPOCHS  = 101
```

### åˆå§‹åŒ–å’Œé¢„å¤„ç†

*   åˆå§‹åŒ–é‰´åˆ«å™¨å’Œå‘ç”Ÿå™¨ï¼Œå¹¶å°†å…¶æ”¾å…¥è®¾å¤‡ä¸­
*   è®¾ç½®ä¸€äº›å›ºå®šçš„å™ªå£°æ¥è§‚å¯Ÿç›¸åŒçš„åˆ†å¸ƒå›¾åƒåœ¨ä¸åŒæ—¶æœŸæ˜¯å¦‚ä½•å˜åŒ–çš„
*   åˆå§‹åŒ–ç”¨äºæ•°æ®æ‰©å……çš„è½¬æ¢(RandomHorizontalFlip ),å¹¶å°†æˆ‘ä»¬çš„å›¾åƒå½’ä¸€åŒ–åˆ°-1 å’Œ 1 ä¹‹é—´
*   ä¸‹è½½ MNIST æ•°æ®é›†å¹¶å¯¹å…¶åº”ç”¨å˜æ¢
*   ä½¿ç”¨æ•°æ®åŠ è½½å™¨åˆ›å»ºå°æ‰¹é‡
*   åˆå§‹åŒ–é‰´åˆ«å™¨å’Œç”Ÿæˆå™¨çš„ä¼˜åŒ–å™¨ï¼Œæˆ‘ä»¬å°†å¯¹ä¸¤è€…éƒ½ä½¿ç”¨ Adam
*   ç”¨ BCELoss åˆå§‹åŒ–æŸå¤±ï¼Œå› ä¸ºå®ƒä¸æˆ‘ä»¬ä¹‹å‰çœ‹åˆ°çš„ GANs æŸå¤±éå¸¸æ¥è¿‘

![](img/c378867cd53efbd1cba474b8835dcd29.png)

[BCEloss](https://pytorch.org/docs/stable/generated/torch.nn.BCELoss.html)

```py
disc        = Discriminator(IMG_DIM).to(DEVICE)
gen         = Generator(Z_DIM, IMG_DIM).to(DEVICE) 
fixed_noice = torch.randn((BS, Z_DIM)).to(DEVICE) 
transforms  = transforms.Compose([transforms.RandomHorizontalFlip(), transforms.ToTensor(),transforms.Normalize((0.5,),(0.5,))])
dataset     = datasets.MNIST(root = 'dataset/', transform = transforms, download = True)
loader      = DataLoader(dataset, batch_size=BS, shuffle=True)
opt_disc    = optim.Adam(disc.parameters(), lr=LR)
opt_gen     = optim.Adam(gen.parameters(), lr=LR)
criterion   = nn.BCELoss()
```

### ç»˜åˆ¶ä¸€äº›çœŸå®çš„æ ·æœ¬

è®©æˆ‘ä»¬ç”»ä¸€äº›çœŸå®çš„æ ·å“ï¼Œçœ‹çœ‹ä»–ä»¬çœ‹èµ·æ¥å¦‚ä½•ã€‚

```py
real, y = next(iter(loader))
_, ax = plt.subplots(5,5, figsize=(10,10))
plt.suptitle('Some real samples', fontsize=19, fontweight='bold')

ind = 0 
for k in range(5):
    for kk in range(5):
        ind += 1
        ax[k][kk].imshow(real[ind][0])
```

![](img/d77d5fed1957972168003f003c10aa0c.png)

### åŸ¹å…»

ç°åœ¨æœ‰è¶£çš„éƒ¨åˆ†ï¼Œé­”æœ¯å°†ä¼šå‘ç”Ÿï¼Œåœ¨è¿™ä¸€éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬å°†è®­ç»ƒæˆ‘ä»¬çš„ GANï¼Œå¹¶ä¸º 0ã€50 å’Œ 100 ä¸ªæ—¶æœŸç»˜åˆ¶ä¸€äº›å‡æ ·æœ¬ã€‚

ä¸ºäº†è®­ç»ƒ GANï¼Œæˆ‘ä»¬å¾ªç¯ä½¿ç”¨ DataLoader åˆ›å»ºçš„æ‰€æœ‰å°æ‰¹é‡ï¼Œå¹¶ä¸”æˆ‘ä»¬åªè·å–å›¾åƒï¼Œå› ä¸ºæˆ‘ä»¬ä¸éœ€è¦æ ‡ç­¾ã€‚è¿™ä½¿å¾—å®ƒæˆä¸ºæ— ç›‘ç£å­¦ä¹ ã€‚æˆ‘ä»¬å°†å›¾åƒå‘½åä¸º realï¼Œå› ä¸ºå®ƒä»¬æ˜¯çœŸå®çš„ï¼Œæˆ‘ä»¬ä½¿ç”¨`real.view(-1, 784)`å¯¹å®ƒä»¬è¿›è¡Œæ•´å½¢ï¼Œä»¥ä¿æŒæˆ‘ä»¬æ‰¹æ¬¡ä¸­çš„ç¤ºä¾‹æ•°é‡ï¼Œç„¶åæˆ‘ä»¬å±•å¹³å…¶ä»–æ‰€æœ‰å†…å®¹ï¼Œå¹¶å°†æˆ‘ä»¬çš„æ‰¹æ¬¡å¤§å°å¸¦åˆ°è®¾å¤‡ä¸­ã€‚

ç°åœ¨ï¼Œè®©æˆ‘ä»¬ä¸ºé‰´åˆ«å™¨è®¾ç½®åŸ¹è®­ã€‚è®°ä½ï¼Œå®ƒè¦æœ€å¤§åŒ– **log(D(å®))+ log(1-D(G(z)))** ã€‚

ä¸ºäº†è·å¾—ç¬¬ä¸€é¡¹ **log(D(real))** æˆ‘ä»¬ç”¨ **D(real)** ä»£æ›¿ BCELoss ä¸­çš„ xï¼ŒD(real) æ˜¯é‰´åˆ«å™¨æ‹æ‘„çœŸå®å›¾åƒæ—¶çš„è¾“å‡ºï¼Œæˆ‘ä»¬ç”¨ 1 ä»£æ›¿ yã€‚æˆ‘ä»¬çš„æ–°æ–¹ç¨‹å°†å…·æœ‰ä»¥ä¸‹å½¢å¼:

![](img/73c56e0b193c920d78ffc04b19eaa521.png)

ä½ å¯ä»¥æ³¨æ„åˆ°ï¼Œæˆ‘ä»¬æŠŠ wn ä»ç­‰å¼ä¸­å»æ‰äº†ï¼Œå› ä¸ºå®ƒåªæœ‰ä¸€ä¸ªï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å¿½ç•¥å®ƒã€‚ä½†è¿™é‡Œé‡è¦çš„éƒ¨åˆ†æ˜¯ï¼Œæˆ‘ä»¬å‰é¢æœ‰ä¸€ä¸ªè´Ÿå·ï¼Œè¿™æ„å‘³ç€å¦‚æœæˆ‘ä»¬æƒ³è¦æœ€å¤§åŒ– **log(D(real))** ï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦æœ€å°åŒ–è¯¥è¡¨è¾¾å¼çš„è´Ÿå€¼ï¼Œå¦‚æœä½ ä¹ æƒ¯äºè®­ç»ƒç¥ç»ç½‘ç»œï¼Œä½ é€šå¸¸ä¼šæƒ³è¦æœ€å°åŒ–æŸå¤±å‡½æ•°ã€‚

ä¸ºäº†è·å¾—ç¬¬äºŒé¡¹ **log(1-D(G(z)))** æˆ‘ä»¬ç”¨ **D(G(z))** ä»£æ›¿ BCELoss ä¸­çš„ xï¼ŒD(G(z)) æ˜¯é‰´åˆ«å™¨åœ¨è·å–ç”Ÿæˆå™¨ç”Ÿæˆçš„å‡å›¾åƒæ—¶çš„è¾“å‡ºã€‚ç„¶åï¼Œæˆ‘ä»¬ç”¨é›¶ä»£æ›¿ yï¼Œå› æ­¤æˆ‘ä»¬æœ‰ä»¥ä¸‹ç­‰å¼:

![](img/1f0497414b8280665700e9e670085411.png)

> æ³¨æ„:ä¸ºäº†è®­ç»ƒç”Ÿæˆå™¨ï¼Œæˆ‘ä»¬ä¹Ÿå°†ä½¿ç”¨ G(z ),æ²¡æœ‰å¿…è¦å†åšä¸€éã€‚å½“è®¡ç®—é‰´é¢‘å™¨çš„åå‘æŸè€—æ—¶ï¼Œæ­£å‘ä¼ é€’ä¸­ç”¨äºè®¡ç®—è¿™äº›æ¢¯åº¦çš„æ‰€æœ‰å†…å®¹éƒ½å·²ä»ç¼“å­˜ä¸­æ¸…é™¤ã€‚å¦‚æœæˆ‘ä»¬æƒ³é˜²æ­¢è¿™ç§æ¸…é™¤ï¼Œæˆ‘ä»¬æ·»åŠ è¿™ä¸ªå‚æ•° **retain_graph=Trueã€‚**

ç°åœ¨ï¼Œè®©æˆ‘ä»¬ä¸ºæƒ³è¦æœ€å°åŒ– **log(1-D(G(z)))** çš„ç”Ÿæˆå™¨è®¾ç½®è®­ç»ƒï¼Œä½†æ˜¯åœ¨å®è·µä¸­ï¼Œæ­£å¦‚æˆ‘ä¹‹å‰æ‰€è¯´çš„ï¼Œæˆ‘ä»¬æ”¹ä¸ºæœ€å¤§åŒ–**log(D(G(z))ã€‘**ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬ä¹Ÿä½¿ç”¨ BCELossï¼Œç”¨ D(G(z))ä»£æ›¿ xï¼Œç”¨ 1 ä»£æ›¿ yï¼Œä»¥è·å¾—è¯¥ç­‰å¼:

![](img/afd7cb3a069811b259b837fbf61cdc8f.png)

æœ€åï¼Œæˆ‘ä»¬å‡†å¤‡å†™ä¸€äº›ä»£ç æ¥ç»˜åˆ¶ä¸€äº›å‡æ ·æœ¬ï¼Œå¹¶å°½å¯èƒ½å¤šçš„é‡å¤æ‰€æœ‰è¿™äº›ã€‚

```py
for epoch in range(EPOCHS):
    for real,_ in loader:
        real       = real.view(-1, 784).to(DEVICE)
        batch_size = real.shape[0]
        ######## train Discriminator: max log(D(real)) + log(1-D(G(z)))
        noise     = torch.randn(batch_size, Z_DIM).to(DEVICE)
        fake      = gen(noise)
        disc_real = disc(real).view(-1) #shape [64,1] -> [64] 
        lossD_real= criterion(disc_real, torch.ones_like(disc_real))
        disc_fake = disc(fake).view(-1)
        lossD_fake= criterion(disc_fake, torch.zeros_like(disc_fake))
        lossD     = (lossD_real + lossD_fake)/2
        disc.zero_grad()
        lossD.backward(retain_graph=True) # Add retain_graph=True, To save fake in memory 
        opt_disc.step()

        ######## train Generator: min log(1-D(G(z))) <==> max log(D(G(z)))
        output = disc(fake).view(-1)
        lossG  = criterion(output, torch.ones_like(output))
        gen.zero_grad()
        lossG.backward()
        opt_gen.step()

    print(
                f"Epoch [{epoch}/{EPOCHS}] \
                      Loss D: {lossD:.4f}, loss G: {lossG:.4f}"
    )

    if epoch %50 == 0:
        with torch.no_grad():
            fake = gen(fixed_noice).reshape(-1, 1, 28, 28).cpu()
        _, ax = plt.subplots(5,5, figsize=(10,10))
        plt.suptitle('Results of epoch '+str(epoch), fontsize=19, fontweight='bold')

        ind = 0 
        for k in range(5):
            for kk in range(5):
                ind += 1
                ax[k][kk].imshow(fake[ind][0])
```

è¿™äº›å›¾åƒå¹¶ä¸å®Œç¾ï¼Œä½†çœ‹èµ·æ¥è¿˜ä¸é”™ï¼å¦‚æœä½ è®­ç»ƒçš„æ—¶é—´æ›´é•¿ï¼Œä½ å¯ä»¥æœŸå¾…è¿™äº›ä¼šå˜å¾—æ›´å¥½ã€‚å¸Œæœ›æ‚¨èƒ½å¤Ÿéµå¾ªæ‰€æœ‰æ­¥éª¤ï¼Œå¹¶ç†è§£å¦‚ä½•å®ç°ç®€å•çš„å›¾åƒç”Ÿæˆ GANã€‚

# ç»“è®º

åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡è°ˆè®ºä¸€äº›å¾ˆé…·çš„åº”ç”¨ç¨‹åºï¼Œå¦‚ç”Ÿæˆä¸å­˜åœ¨çš„çœŸå®äººè„¸ã€æ¢å¤ã€æ®–æ°‘ã€æé«˜ç…§ç‰‡åˆ†è¾¨ç‡å’Œè·¨åŸŸè½¬æ¢å›¾åƒï¼Œå‘ç°äº†ä¸ºä»€ä¹ˆ gan å¾ˆæ£’ã€‚ç„¶åï¼Œæˆ‘ä»¬åˆ†æäº† GANs åˆ°åº•æ˜¯ä»€ä¹ˆï¼Œå¹¶å¯¹å®ƒä»¬çš„å·¥ä½œæ–¹å¼æœ‰äº†ç›´è§‚çš„äº†è§£ã€‚æˆ‘ä»¬æ·±å…¥ç ”ç©¶äº†é‰´é¢‘å™¨å’Œå‘ç”Ÿå™¨ä½¿ç”¨çš„æŸè€—å‡½æ•°ï¼Œæœ€åï¼Œæˆ‘ä»¬ä»å¤´å¼€å§‹å®ç°äº†ä¸€ä¸ªç®€å•çš„ GAN æ¥äº§ç”Ÿ MNISTã€‚

åœ¨æ¥ä¸‹æ¥çš„æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†è§£é‡Šå¹¶ä»å¤´å®ç°æ›´é«˜çº§çš„ GANs æ¥ç”Ÿæˆæ›´é…·æ›´å¤æ‚çš„æ•°æ®ã€‚